<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Eviatar Guttman - Multinomial Logit Example</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Eviatar Guttman</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./1_mortgage.html">Mortgage Simulation</a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-merger-simulation" role="button" data-bs-toggle="dropdown" aria-expanded="false">Merger Simulation</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-merger-simulation">    
        <li>
    <a class="dropdown-item" href="./2_merger_sim_intro.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./3_multinomial_logit.html">
 <span class="dropdown-text">Multinomial logit</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./4_nested.html">
 <span class="dropdown-text">Nested Logit</span></a>
  </li>  
    </ul>
  </li>
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">introduction</a></li>
  <li><a href="#pre-merger-conditions" id="toc-pre-merger-conditions" class="nav-link" data-scroll-target="#pre-merger-conditions">Pre merger conditions</a></li>
  <li><a href="#merger-simulate" id="toc-merger-simulate" class="nav-link" data-scroll-target="#merger-simulate">Merger simulate</a>
  <ul class="collapse">
  <li><a href="#fixed-point-iteration" id="toc-fixed-point-iteration" class="nav-link" data-scroll-target="#fixed-point-iteration">Fixed point iteration</a></li>
  <li><a href="#manual-iteration" id="toc-manual-iteration" class="nav-link" data-scroll-target="#manual-iteration">Manual iteration</a></li>
  <li><a href="#while-loop" id="toc-while-loop" class="nav-link" data-scroll-target="#while-loop">While loop</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Multinomial Logit Example</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>introduction</h1>
<p>In this document I’ll demonstrate merger simulation with a synthetic example. On the supply side assuming a differentiated Bertrand model and on the demand side assuming a multinomial logit demand function.</p>
<p>The Bertrand system of equations has 4 components:<br>
(1) Market shares.<br>
(2) Prices.<br>
(3) Derivatives of the demand function with respect to the prices.<br>
(4) Marginal costs of the firms.</p>
</section>
<section id="pre-merger-conditions" class="level1">
<h1>Pre merger conditions</h1>
<p>For the sake of demonstration the market shares chosen are <code>0.2, 0.25</code> and <code>0.3</code>.<br>
prices are <code>50, 75</code> and <code>80</code> correspondingly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. market shares</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.25</span>, <span class="fl">0.3</span>) </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># outside option market share</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>(s_0 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>(s) )</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.25</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. prices</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">80</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Calculation of derivatives</strong><br>
The logit derivative is a function of market shares and the consumer’s derivative with respect to the price - the model’s <span class="math inline">\(alpha\)</span>. we’ll choose <span class="math inline">\(alpha\)</span> to be 0.1. In fact, this is a calibration of the system. One can estimate those parameters with a demand estimation (which is beyond the scope of this simple document).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. derivatives</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># choose alpha  </span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="sc">-</span> <span class="fl">0.1</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># derivatives are functions of market shares and alpha</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># own derivative</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>(d_sj_d_pj <span class="ot">&lt;-</span> alpha <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>s) <span class="sc">*</span> s)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] -0.0160 -0.0188 -0.0210</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># cross derivative</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>(d_sk_d_pj <span class="ot">&lt;-</span> <span class="sc">-</span> alpha <span class="sc">*</span> s <span class="sc">%o%</span> s)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="do">##       [,1]    [,2]   [,3]</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] 0.004 0.00500 0.0060</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,] 0.005 0.00625 0.0075</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,] 0.006 0.00750 0.0090</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># put own derivatives in diagonal</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>der <span class="ot">&lt;-</span> d_sk_d_pj</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(der) <span class="ot">&lt;-</span> d_sj_d_pj</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># final result</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>der</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="do">##        [,1]    [,2]    [,3]</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] -0.016  0.0050  0.0060</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]  0.005 -0.0188  0.0075</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,]  0.006  0.0075 -0.0210</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the diagonal is negative -&gt; self elasticity is negative, and the off-diagonal are positive which means products are substitutes.</p>
<p><strong>Solving the equation system for the marginal costs</strong><br>
As stated above, First order condition has 4 components.<br>
We have supplied the market shares, the prices and the derivatives. Next, we solve the system for the marginal costs.</p>
<p>For the solution we create the “owner ship” matrix:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. solving a system of equations for the marginal costs</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ownership matrix</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>(theta <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># solve a system of linear equations</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>(mc <span class="ot">&lt;-</span> <span class="fu">solve</span>(theta <span class="sc">*</span> der) <span class="sc">%*%</span> s <span class="sc">+</span> p )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]
[1,] 37.5
[2,] 61.7
[3,] 65.7</code></pre>
</div>
</div>
<p>We can check the first order condition are valid.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check that F.O.C's are met: </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>s <span class="sc">+</span> (theta <span class="sc">*</span> der) <span class="sc">%*%</span> (p <span class="sc">-</span> mc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       [,1]
[1,] -0.0000000000000000278
[2,]  0.0000000000000000555
[3,] -0.0000000000000001110</code></pre>
</div>
</div>
</section>
<section id="merger-simulate" class="level1">
<h1>Merger simulate</h1>
<p><strong>A merger in the market</strong><br>
When a merger happens, the ownership of firms over the product set is changing. Next, we’ll assume that products 1 and 2 are now under the same ownership. For that, we update the ownership matrix. The 1st and 2nd elements 1st and 2nd rows of the matrix will equal to 1:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># new ownership matrix: </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>(theta_post <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    1    0
[2,]    1    1    0
[3,]    0    0    1</code></pre>
</div>
</div>
<p>Changing the ownership matrix resembles the change in the incentives the merged firm forgo. The firm understands that when the price of product 1 goes up, some of the customers that choose to not buy it anymore will by product 2. The closer substitutes are the products the larger proportion of customers will diverge between product 1 to 2 and vice versa. Hence for those customers, the firm does not loose its sails. With that knowledge, the firm can raise the price up. The first order condition is not valid anymore because the old price is not the optimal price.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># FOC don't hold</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>s <span class="sc">+</span> (theta_post <span class="sc">*</span> der) <span class="sc">%*%</span> (p <span class="sc">-</span> mc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      [,1]
[1,]  0.066666666666666624
[2,]  0.062500000000000056
[3,] -0.000000000000000111</code></pre>
</div>
</div>
<section id="fixed-point-iteration" class="level2">
<h2 class="anchored" data-anchor-id="fixed-point-iteration">Fixed point iteration</h2>
<p>This change in the merged firm incentives has a ripple effect on the entire market. The firm will raise its prices, some of the customers will leave its products and either buy it at the competitors or not buy it at all. To compute this, we need an iterative process that will end in a new equilibrium.</p>
<p>Assuming convexity and continuity of the equation system, we can find a solution and know it is unique.</p>
<p>according to the model , the average utility from product j is: <span class="math display">\[ \delta_j = x \beta_j - \alpha p + \xi _j \]</span><br>
For each product we calculate the average utility.</p>
<p>A change in price will change the utility from the product. This in turn, will be reflected in the demand function, the demand decreases when the price goes up and vice versa.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># delta = x * b - alpha * p</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>(delta <span class="ot">&lt;-</span> <span class="fu">log</span>(s <span class="sc">/</span> s_0)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.223  0.000  0.182</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(delta) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">sum</span>(<span class="fu">exp</span>(delta)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.20 0.25 0.30</code></pre>
</div>
</div>
</section>
<section id="manual-iteration" class="level2">
<h2 class="anchored" data-anchor-id="manual-iteration">Manual iteration</h2>
<p>We’ll compute the first few iterations be hand to see how it converges.<br>
In every iteration 4 stages will take place:</p>
<ol type="1">
<li>Solve the firms first order conditions subject to market shares to find a new price vector.</li>
<li>Calculate the change in the price vector compared to the pre-merger state.</li>
<li>feed the new prices to consumer utility functions to get the change in utilities.</li>
<li>Get the new market shares out from the demand function.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the price update procedure: </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. solve FOC 1</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>(p1 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(mc <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span> <span class="sc">-</span> alpha) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span>  theta_post <span class="sc">%*%</span> s))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 55.7 79.8 80.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. delta price</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>(d_p <span class="ot">&lt;-</span> (p1 <span class="sc">-</span> p))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.68 4.85 0.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. delta in utility</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>(d_delta <span class="ot">&lt;-</span> d_p <span class="sc">*</span> alpha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.568 -0.485  0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. solve demand for new utility</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>(s1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(delta <span class="sc">+</span> d_delta) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">sum</span>(<span class="fu">exp</span>(delta <span class="sc">+</span> d_delta))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.139 0.188 0.367</code></pre>
</div>
</div>
<p>Get the results and compere to the pre merger status.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span><span class="fu">rbind</span>(<span class="fu">c</span>(s, p), <span class="fu">c</span>(s1, p1)) </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]  [,2]  [,3] [,4] [,5] [,6]
[1,] 0.200 0.250 0.300 50.0 75.0   80
[2,] 0.139 0.188 0.367 55.7 79.8   80</code></pre>
</div>
</div>
<p>Repeat the process several more times.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># solve FOC 2:</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(mc <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span> <span class="sc">-</span>alpha) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">-</span>  theta_post <span class="sc">%*%</span> s1)))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>d_p <span class="ot">&lt;-</span> (p2 <span class="sc">-</span> p) </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>d_delta <span class="ot">&lt;-</span> d_p <span class="sc">*</span> alpha</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># solve demand 2:</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>s2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(delta <span class="sc">+</span> d_delta) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">sum</span>(<span class="fu">exp</span>( delta <span class="sc">+</span> d_delta)))</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, <span class="fu">c</span>(s2, p2))</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># solve FOC 3:</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(mc <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span> <span class="sc">-</span>alpha) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">-</span>  theta_post <span class="sc">%*%</span> s2)))</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>d_p <span class="ot">&lt;-</span> (p3 <span class="sc">-</span> p) </span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>d_delta <span class="ot">&lt;-</span> d_p <span class="sc">*</span> alpha</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co"># solve demand 3:</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>s3 <span class="ot">&lt;-</span> <span class="fu">exp</span>(delta <span class="sc">+</span> d_delta) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">sum</span>(<span class="fu">exp</span>( delta <span class="sc">+</span> d_delta)))</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, <span class="fu">c</span>(s3, p3))</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co"># solve FOC 4:</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(mc <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span> <span class="sc">-</span>alpha) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">-</span>  theta_post <span class="sc">%*%</span> s3)))</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>d_p <span class="ot">&lt;-</span> (p4 <span class="sc">-</span> p) </span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>d_delta <span class="ot">&lt;-</span> d_p <span class="sc">*</span> alpha</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co"># solve demand 3:</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>s4 <span class="ot">&lt;-</span> <span class="fu">exp</span>(delta <span class="sc">+</span> d_delta) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">sum</span>(<span class="fu">exp</span>( delta <span class="sc">+</span> d_delta)))</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, <span class="fu">c</span>(s4, p4))</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="co"># solve FOC 5:</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(mc <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span> <span class="sc">-</span>alpha) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">-</span>  theta_post <span class="sc">%*%</span> s4)))</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>d_p <span class="ot">&lt;-</span> (p5 <span class="sc">-</span> p) </span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>d_delta <span class="ot">&lt;-</span> d_p <span class="sc">*</span> alpha</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="co"># solve demand 3:</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>s5 <span class="ot">&lt;-</span> <span class="fu">exp</span>(delta <span class="sc">+</span> d_delta) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">sum</span>(<span class="fu">exp</span>( delta <span class="sc">+</span> d_delta)))</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, <span class="fu">c</span>(s5, p5))</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="co"># solve FOC 6:</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(mc <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span> <span class="sc">-</span>alpha) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">-</span>  theta_post <span class="sc">%*%</span> s5)))</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>d_p <span class="ot">&lt;-</span> (p6 <span class="sc">-</span> p) </span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>d_delta <span class="ot">&lt;-</span> d_p <span class="sc">*</span> alpha</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="co"># solve demand</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>s6 <span class="ot">&lt;-</span> <span class="fu">exp</span>(delta <span class="sc">+</span> d_delta) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">sum</span>(<span class="fu">exp</span>( delta <span class="sc">+</span> d_delta)))</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, <span class="fu">c</span>(s6, p6))</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a><span class="co"># solve FOC 7:</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(mc <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span> <span class="sc">-</span>alpha) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">-</span>  theta_post <span class="sc">%*%</span> s6)))</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>d_p <span class="ot">&lt;-</span> (p7 <span class="sc">-</span> p) </span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>d_delta <span class="ot">&lt;-</span> d_p <span class="sc">*</span> alpha</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a><span class="co"># solve demand</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>s7 <span class="ot">&lt;-</span> <span class="fu">exp</span>(delta <span class="sc">+</span> d_delta) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">sum</span>(<span class="fu">exp</span>( delta <span class="sc">+</span> d_delta)))</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, <span class="fu">c</span>(s7, p7))</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a><span class="co"># solve FOC 8:</span></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>p8 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(mc <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span> <span class="sc">-</span>alpha) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">-</span>  theta_post <span class="sc">%*%</span> s7)))</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>d_p <span class="ot">&lt;-</span> (p8 <span class="sc">-</span> p) </span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>d_delta <span class="ot">&lt;-</span> d_p <span class="sc">*</span> alpha</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a><span class="co"># solve demand</span></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>s8 <span class="ot">&lt;-</span> <span class="fu">exp</span>(delta <span class="sc">+</span> d_delta) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">sum</span>(<span class="fu">exp</span>( delta <span class="sc">+</span> d_delta)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the <code>results</code> matrix, columns 1-3 are market shares and columns 4-6 are the prices.<br>
every iteration the jumps in the values decreases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, <span class="fu">c</span>(s8, p8))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(results) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'s1'</span>, <span class="st">'s2'</span>, <span class="st">'s3'</span>, <span class="st">'p1'</span>, <span class="st">'p2'</span>, <span class="st">'p3'</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         s1    s2    s3   p1   p2   p3
 [1,] 0.200 0.250 0.300 50.0 75.0 80.0
 [2,] 0.139 0.188 0.367 55.7 79.8 80.0
 [3,] 0.179 0.244 0.293 52.4 76.5 81.5
 [4,] 0.146 0.198 0.360 54.8 79.0 79.9
 [5,] 0.175 0.237 0.301 52.7 76.9 81.3
 [6,] 0.150 0.204 0.352 54.5 78.7 80.0
 [7,] 0.171 0.232 0.308 53.0 77.1 81.1
 [8,] 0.153 0.208 0.346 54.3 78.4 80.2
 [9,] 0.169 0.229 0.314 53.1 77.3 81.0</code></pre>
</div>
</div>
<p>We can see where it’s going. the shares of products 1 and 2 are decreasing and product 3 is increasing. All prices are going up.</p>
<p>Lets calculate the new equilibrium.</p>
</section>
<section id="while-loop" class="level2">
<h2 class="anchored" data-anchor-id="while-loop">While loop</h2>
<p>We’ll limit the number of iterations with <code>max_iter</code>, and document the convergence process in a <code>convergence_matrix</code> .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>max_iter <span class="ot">&lt;-</span> <span class="dv">82</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>s_in <span class="ot">&lt;-</span> s</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>s_delta_norm <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>convergence_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> max_iter, <span class="at">ncol =</span> <span class="fu">length</span>(s) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(s_delta_norm <span class="sc">&gt;</span> <span class="fl">1e-6</span> <span class="sc">&amp;</span> i <span class="sc">&lt;</span> max_iter){</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># solve F.O.C</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  ( p_new <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(mc <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span> <span class="sc">-</span> alpha ) <span class="sc">*</span> ( <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span>  theta_post <span class="sc">%*%</span> s_in) )))</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># change in utility</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  d_delta <span class="ot">&lt;-</span> (p_new <span class="sc">-</span> p) <span class="sc">*</span> alpha</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># solve demand system</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  s_new <span class="ot">&lt;-</span> <span class="fu">exp</span>(delta <span class="sc">+</span> d_delta) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">sum</span>(<span class="fu">exp</span>(delta <span class="sc">+</span> d_delta)))</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># norm of change in market shares</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  (s_delta_norm <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>((s_in <span class="sc">-</span> s_new) <span class="sc">^</span> <span class="dv">2</span>)))</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># save resault for next iteration</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  s_in <span class="ot">&lt;-</span> s_new</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  convergence_matrix[i, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(s_new,  p_new, s_delta_norm, i)</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(convergence_matrix) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"s1"</span>, <span class="st">"s2"</span>, <span class="st">"s3"</span>, <span class="st">"p1"</span>, <span class="st">"p2"</span>, <span class="st">"p3"</span>, <span class="st">"norm"</span>, <span class="st">"iteration"</span>)</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>convergence_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         s1    s2    s3   p1   p2   p3        norm iteration
 [1,] 0.139 0.188 0.367 55.7 79.8 80.0 0.109827719         1
 [2,] 0.179 0.244 0.293 52.4 76.5 81.5 0.101188131         2
 [3,] 0.146 0.198 0.360 54.8 79.0 79.9 0.087867750         3
 [4,] 0.175 0.237 0.301 52.7 76.9 81.3 0.076132778         4
 [5,] 0.150 0.204 0.352 54.5 78.7 80.0 0.065389010         5
 [6,] 0.171 0.232 0.308 53.0 77.1 81.1 0.056301895         6
 [7,] 0.153 0.208 0.346 54.3 78.4 80.2 0.048324608         7
 [8,] 0.169 0.229 0.314 53.1 77.3 81.0 0.041574711         8
 [9,] 0.155 0.211 0.341 54.1 78.3 80.3 0.035693191         9
[10,] 0.167 0.227 0.317 53.3 77.4 80.9 0.030698062        10
[11,] 0.157 0.213 0.338 54.0 78.1 80.4 0.026361844        11
[12,] 0.165 0.225 0.320 53.4 77.5 80.8 0.022667853        12
[13,] 0.158 0.215 0.335 53.9 78.1 80.4 0.019469604        13
[14,] 0.164 0.223 0.322 53.4 77.6 80.8 0.016738813        14
[15,] 0.159 0.216 0.334 53.8 78.0 80.5 0.014379099        15
[16,] 0.164 0.222 0.324 53.5 77.7 80.7 0.012360880        16
[17,] 0.160 0.217 0.332 53.8 77.9 80.5 0.010619418        17
[18,] 0.163 0.222 0.325 53.5 77.7 80.7 0.009128122        18
[19,] 0.160 0.218 0.331 53.7 77.9 80.5 0.007842695        19
[20,] 0.163 0.221 0.326 53.6 77.7 80.7 0.006740912        20
[21,] 0.160 0.218 0.331 53.7 77.9 80.6 0.005791974        21
[22,] 0.162 0.221 0.327 53.6 77.8 80.7 0.004978054        22
[23,] 0.161 0.218 0.330 53.7 77.9 80.6 0.004277453        23
[24,] 0.162 0.220 0.327 53.6 77.8 80.6 0.003676234        24
[25,] 0.161 0.219 0.330 53.7 77.9 80.6 0.003158943        25
[26,] 0.162 0.220 0.327 53.6 77.8 80.6 0.002714868        26
[27,] 0.161 0.219 0.329 53.7 77.8 80.6 0.002332905        27
[28,] 0.162 0.220 0.328 53.6 77.8 80.6 0.002004913        28
[29,] 0.161 0.219 0.329 53.7 77.8 80.6 0.001722864        29
[30,] 0.162 0.220 0.328 53.6 77.8 80.6 0.001480620        30
[31,] 0.161 0.219 0.329 53.7 77.8 80.6 0.001272343        31
[32,] 0.162 0.220 0.328 53.6 77.8 80.6 0.001093433        32
[33,] 0.161 0.219 0.329 53.7 77.8 80.6 0.000939630        33
[34,] 0.162 0.220 0.328 53.6 77.8 80.6 0.000807498        34
[35,] 0.161 0.219 0.329 53.7 77.8 80.6 0.000693919        35
[36,] 0.162 0.220 0.328 53.6 77.8 80.6 0.000596336        36
[37,] 0.161 0.219 0.329 53.7 77.8 80.6 0.000512461        37
[38,] 0.162 0.219 0.328 53.6 77.8 80.6 0.000440394        38
[39,] 0.161 0.219 0.329 53.7 77.8 80.6 0.000378453        39
[40,] 0.162 0.219 0.328 53.6 77.8 80.6 0.000325231        40
[41,] 0.161 0.219 0.329 53.7 77.8 80.6 0.000279488        41
[42,] 0.162 0.219 0.328 53.6 77.8 80.6 0.000240183        42
[43,] 0.161 0.219 0.329 53.7 77.8 80.6 0.000206402        43
[44,] 0.161 0.219 0.328 53.6 77.8 80.6 0.000177375        44
[45,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000152428        45
[46,] 0.161 0.219 0.328 53.6 77.8 80.6 0.000130991        46
[47,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000112568        47
[48,] 0.161 0.219 0.328 53.6 77.8 80.6 0.000096737        48
[49,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000083132        49
[50,] 0.161 0.219 0.328 53.6 77.8 80.6 0.000071440        50
[51,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000061393        51
[52,] 0.161 0.219 0.328 53.6 77.8 80.6 0.000052759        52
[53,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000045339        53
[54,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000038962        54
[55,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000033483        55
[56,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000028774        56
[57,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000024727        57
[58,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000021249        58
[59,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000018261        59
[60,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000015693        60
[61,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000013486        61
[62,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000011589        62
[63,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000009959        63
[64,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000008559        64
[65,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000007355        65
[66,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000006320        66
[67,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000005432        67
[68,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000004668        68
[69,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000004011        69
[70,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000003447        70
[71,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000002962        71
[72,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000002546        72
[73,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000002188        73
[74,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000001880        74
[75,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000001616        75
[76,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000001388        76
[77,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000001193        77
[78,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000001025        78
[79,] 0.161 0.219 0.328 53.7 77.8 80.6 0.000000881        79
[80,]    NA    NA    NA   NA   NA   NA          NA        NA
[81,]    NA    NA    NA   NA   NA   NA          NA        NA
[82,]    NA    NA    NA   NA   NA   NA          NA        NA</code></pre>
</div>
</div>
<p>Compare the data before the merger with the prediction of the simulation about the merger effect on prices and market shares</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># attach preconditions with last row without NA's in the matrix</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>final_resault <span class="ot">&lt;-</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  convergence_matrix[<span class="fu">tail</span>(<span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(convergence_matrix)) <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="dv">1</span>),]</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">c</span>(results[<span class="dv">1</span>,],<span class="at">norm =</span> <span class="cn">NA</span>,<span class="at">iteration =</span> <span class="dv">0</span>),final_resault)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 s1    s2    s3   p1   p2   p3        norm iteration
              0.200 0.250 0.300 50.0 75.0 80.0          NA         0
final_resault 0.161 0.219 0.328 53.7 77.8 80.6 0.000000881        79</code></pre>
</div>
</div>
<p>The market share of the outside option has increased:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">before =</span> s_0, <span class="at">after =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>(final_resault[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>before  after 
 0.250  0.291 </code></pre>
</div>
</div>
<p>Present convergence process on a plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, patchwork)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(convergence_matrix) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(iteration, p1, p2, p3) <span class="sc">%&gt;%</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">k =</span> <span class="st">"k"</span>, <span class="at">v =</span> <span class="st">"prices"</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> iteration, <span class="at">y =</span> prices, <span class="at">color =</span> k)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(convergence_matrix) <span class="sc">%&gt;%</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(iteration, s1, s2, s3) <span class="sc">%&gt;%</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">k =</span> <span class="st">"k"</span>, <span class="at">v =</span> <span class="st">"shares"</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> iteration, <span class="at">y =</span> shares, <span class="at">color =</span> k)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">size =</span><span class="fl">1.2</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="3_multinomial_logit_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>First order conditions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>s_in <span class="sc">+</span> (theta_post<span class="sc">*</span>der) <span class="sc">%*%</span> (p_new <span class="sc">-</span> mc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] -0.01620
[2,] -0.00271
[3,]  0.01573</code></pre>
</div>
</div>
<p>That’s it.</p>
<p>In the next example we’ll show a bit more complicated example of <a href="./4_nested.html">One level Nested logit</a>. Also, the code will be warped up in functions for production.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Copyright 2022, Eviatar Guttman</div>
  </div>
</footer>



</body></html>